<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RPiWall</title>
<style>
html {
  cursor: url(nocursor.gif), default;
}
body {
  padding: 0;
  margin: 0;
  cursor: url(nocursor.gif), default;
  font-family: sans-serif;
}
#backgroundtransition {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  transition: opacity 10s ease-in-out;
  opacity: 0;
}
#redshift {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: black;
  transition: opacity 10s ease-in-out;
}

#clock-container {
  position: relative;
  width: 334px;
}
.clock {
  background: rgba(236,236,236,0);
  width: 100%;
  height: 334px;
  position: relative;
}
.dot {
  width: 5%;
  height: 5%;
  border-radius: 50%;
  background: #ccc;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto;
  position: absolute;
  z-index: 10;
  box-shadow: 0 0 4px -1px black;
}
.minutes-container, .hours-container, .seconds-container {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.hours {
  background: black;
  border: 1px solid white;
  height: 20%;
  left: 48.75%;
  position: absolute;
  top: 29.2%;
  transform-origin: 50% 100%;
  width: 2%;
  border-top-left-radius: 50%;
  border-top-right-radius: 50%;
}
.minutes {
  background: black;
  border: 1px solid white;
  height: 40%;
  left: 48.7%;
  position: absolute;
  top: 9.2%;
  transform-origin: 50% 100%;
  width: 2%;
  border-top-left-radius: 50%;
  border-top-right-radius: 50%;
}
.seconds {
  background: gold;
  height: 45%;
  left: 49.5%;
  position: absolute;
  top: 14%;
  transform-origin: 50% 80%;
  width: 1%;
  z-index: 8;
  border-top-left-radius: 50%;
  border-top-right-radius: 50%;
}
.h12, .h9, .h6, .h3 {
  display: inline-block;
  position: absolute;
  color: white;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
  font-weight: 700;
  z-index: 4;
}
.h12 {
  top: -1.5%;
  left: 46.2%;
}
.h3 {
  top: 46%;
  right: 1%;
}
.h6 {
  bottom: -1%;
  left: 48.3%;
}
.h9 {
  left: 1%%;
  top: 46%;
}

.diallines {
  position: absolute;
  z-index: 2;
  width: 1px;
  height: 5%;
  background: white;
  border: 1px solid black;
  left: 50%;
  margin-left: -1px;
}
.diallines:nth-of-type(5n+1) {
  position: absolute;
  z-index: 2;
  width: 1px;
  height: 8.3%;
  background: white;
  border: 1px solid black;
  left: 50%;
  margin-left: -1px;
}
.diallines:nth-of-type(15n+6) {
  display: none;
}
#date {
  color: white;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
  text-align: center;
  width: 100%;
}
#temperature {
  color: white;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
  width: 100%;
  font-size: 20px;
}
</style>
<script src="suncalc.js"></script> 
<script>
var changeBackgroundMinutes = 15;
function getBackground() {
  var xhr = new XMLHttpRequest();
  xhr.open('POST', "random_pic.php", true);
  xhr.onload = function(e) {
    if (this.status == 200) {
      var lines = this.responseText.split("\n");
      var imageFileName = lines[0];
      document.getElementById("backgroundtransition").style.backgroundImage = 'url(' + imageFileName + ')';
      setTimeout(changeBackground, 10000);
    }
  };
  xhr.send();
}
function copyBackground() {
  document.body.style.backgroundImage = document.getElementById("backgroundtransition").style.backgroundImage;
  document.getElementById("backgroundtransition").style.opacity = 0;
  setTimeout(getBackground, changeBackgroundMinutes*60000);
}
function changeBackground() {
  document.getElementById("backgroundtransition").style.opacity = 1;
  setTimeout(copyBackground, 10000);
// adjust brightness
  var twilight = SunCalc.getTimes(new Date(), 51.2, 3.3);
  var now = new Date();
  if (twilight.sunrise < now && twilight.sunset > now) { // daylight
    document.getElementById("redshift").style.opacity = 0;
  } else { // dark
    document.getElementById("redshift").style.opacity = 0.5;
  }
}

var weekday = ["Zondag", "Maandag", "Dinsdag", "Woensdag", "Donderdag", "Vrijdag", "Zaterdag"];
var month = ["januari", "februari", "maart", "april", "mei", "juni", "juli", "augustus", "september", "october", "november", "december"];
function initLocalClocks() {
  var dialLines = document.getElementsByClassName('diallines');
  var clockEl = document.getElementsByClassName('clock')[0];
  for (var i = 0; i < 60; i++) {
    clockEl.innerHTML += "<div class='diallines'></div>";
    dialLines[i].style.transform = "rotate(" + 6 * i + "deg)";
    dialLines[i].style.transformOrigin = "50% " + parseInt((clockEl.clientHeight * 150) / 300) + "px";
  }
  document.getElementsByClassName('h12')[0].style.fontSize = parseInt((clockEl.clientHeight * 22) / 300) + "px";
  document.getElementsByClassName('h9')[0].style.fontSize = parseInt((clockEl.clientHeight * 22) / 300) + "px";
  document.getElementsByClassName('h6')[0].style.fontSize = parseInt((clockEl.clientHeight * 22) / 300) + "px";
  document.getElementsByClassName('h3')[0].style.fontSize = parseInt((clockEl.clientHeight * 22) / 300) + "px";
  document.getElementById('date').style.fontSize = parseInt((clockEl.clientHeight * 22) / 300) + "px";
  setTimeout(minuteInterval(), new Date().getTime() % 60000);
}
function minuteInterval()
 {
  var date = new Date;
  var secondsContainer = document.getElementsByClassName('seconds-container')[0];
  secondsContainer.style.transition = "";
  setTimeout(function(){
    secondsContainer.style.transform = 'rotateZ(0deg)';
    setTimeout(function(){
      document.getElementsByClassName('minutes-container')[0].style.transform = 'rotateZ('+ (date.getMinutes() * 6) +'deg)';
      document.getElementsByClassName('hours-container')[0].style.transform = 'rotateZ('+ ((date.getHours() * 30) + (date.getMinutes() / 2)) +'deg)';
      document.getElementById("date").innerHTML = weekday[date.getDay()] + ", " + date.getDate() + " " + month[date.getMonth()] + " " + date.getFullYear(); 
      secondsContainer.style.transition = "transform 60s linear";
      secondsContainer.style.transform = 'rotateZ(359deg)';
    }, 30);
  }, 30);
  setTimeout(minuteInterval, 60000 - new Date().getTime() % 60000);
}

setInterval(function() {  // get info from other Raspberry Pi with thermostat
  var xhr = new XMLHttpRequest();
  xhr.open('POST', "getjson.php", true);
  xhr.onload = function(e) {
    if (this.status == 200) {
      thermostat = JSON.parse(atob(this.responseText));
      document.getElementById("temperature").innerHTML = "Kamertemperatuur: " + parseFloat(thermostat[7].roomtemp).toFixed(1) + " Â°C";
    }
  };
  xhr.send();
}, 300000); // every 5 minutes

setInterval(function() {  // get info from remote control
  var xhr = new XMLHttpRequest();
  xhr.open('POST', "curl.php", true);
  xhr.onload = function(e) {
    if (this.status == 200) {
      document.getElementById("temperature").innerHTML = xhr.responseText;
    }
  };
  xhr.send();

/*
  var url         = "https://slimhuis.pindanet.be/remote.php";
  var request     = JSON.stringify({device:"wall"})
  var xmlhttp     = new XMLHttpRequest();

  xmlhttp.open("POST", url);
  xmlhttp.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
  xmlhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
  xmlhttp.setRequestHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
  xmlhttp.setRequestHeader("Access-Control-Allow-Headers", "Content-Type");
  xmlhttp.setRequestHeader("Access-Control-Request-Headers", "X-Requested-With, accept, content-type");

  xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
      var jsondata = JSON.parse(xmlhttp.responseText);
//      document.getElementById("temperature").innerHTML = xmlhttp.responseText;
      switch(jsondata.command) {
        case 'Reload':
          location.reload();
          break;
      }
    }
  };
  xmlhttp.send(request);
*/
}, 60000); // every minute

</script>
</head>
<body onload="getBackground(); initLocalClocks();">
<div id="backgroundtransition"></div>
<div id="redshift" style="opacity: 1;"></div>
 <table style="position: absolute;">
  <tr>
    <td>
      <iframe style="margin-top: -32px;" scrolling="no" width="334" height="158" frameborder="0" marginwidth="0" marginheight="0" src="https://www.meteo.be/services/widget/.?postcode=8000&nbDay=2&type=4&lang=nl&bgImageId=0&bgColor=transparent&scrolChoice=0&colorTempMax=A5D6FF&colorTempMin=ffffff"></iframe>
      <div id="temperature"></div>
    </td>
  </tr>
  <tr>
    <td id="clock-container">
  <article class="clock">
    <div class="dot"></div>
    <div class="hours-container">
      <div class="hours"></div>
    </div>
    <div class="minutes-container">
      <div class="minutes"></div>
    </div>
    <div class="seconds-container">
      <div class="seconds"></div>
    </div>
    <div>
      <span class="h3">3</span>
      <span class="h6">6</span>
      <span class="h9">9</span>
      <span class="h12">12</span>
    </div>
    <div class="diallines"></div>
  </article>
  <div id="date">Donderdag, 31 december 2018</div>
    </td>
  </tr>
</table> 
<div>
</div>
<!-- http://lorempixel.com/1920/1200/nature/
https://source.unsplash.com/random/1920x1200/?nature  -->
</body>
</html> 
